const solicitudes=document.querySelectorAll(".solicitudes");solicitudes.forEach(e=>{e.addEventListener("click",(function(o){EnvioId(e.querySelector(".id").innerHTML.trim(),"http://localhost:3001/solicitudes")}))});const usuarios=document.querySelectorAll(".usuarios");usuarios.forEach(e=>{e.addEventListener("click",(function(o){EnvioId(e.querySelector(".id").innerHTML.trim(),"http://localhost:3001/usuario")}))});const salones=document.querySelectorAll(".salones");salones.forEach(e=>{e.addEventListener("click",(function(o){EnvioId(e.querySelector(".id").innerHTML.trim(),"http://localhost:3001/salon")}))});const bloques=document.querySelectorAll(".bloques");function envioUsuario(){modalNuevoUsuario()}function envioSalon(){modalNuevoSalon()}function envioBloque(){mostrarModal(modalNuevoBloque())}function EnvioId(e,o){if(console.log(e),null!==e){var l=new FormData;l.append("id",e)}try{consultaApi(o,l).then((function(e){if("soporte"==e.remitente)var o=modalServicios(e);else if("docente"==e.remitente){console.log(e);o=modalUsuarios(e)}else if("salon"==e.remitente){console.log(e.bloque);o=modalSalon(e,e.id,e.bloque)}else if("bloque"==e.remitente){console.log(e);o=modalBloque(e)}mostrarModal(o,e.id)}))}catch(e){console.log(e)}}function modalServicios(e){var o;if("terminado"===e.estado){var l="completa";o=e.fecha_final}else if("en_camino"===e.estado){l="camino";o=e.fecha_final}else{l="pendiente";o=e.fecha_inicial}const t=new Date(o).toLocaleDateString("es-ES"),n=document.createElement("DIV");n.classList.add("modal");var a="en_camino"===e.estado?"En Camino":e.estado;return n.innerHTML='\n        <form class="formulario"> \n            <div class="contenedor-titulo">\n            <legend class="">Solicitud '+a+' </legend> \n            <div class="imagen-estado '+l+'"></div>\n            </div>          \n            <div class="campo">\n                <label class="subtitulo" >Tipo:</label>\n                <label>'+e.tipo+'</label>\n            </div>\n            <div class="campo">\n                <label class="subtitulo">Bloque:</label>\n                <label>'+e.bloque+'</label>\n            </div>\n            <div class="campo">\n                <label class="subtitulo">Aula:</label>\n                <label>'+e.aula+'</label>\n            </div>\n            <div class="campo">\n                <label class="subtitulo">Usuario:</label>\n                <label>'+e.usuario+'</label>\n            </div>\n            <div class="campo">\n                <label class="subtitulo">Detalle:</label>\n                <label>'+e.detalle+'</label>\n            </div>     \n            <div class="campo">\n                <label class="subtitulo">Detalle:</label>\n                <label>'+t+'</label>\n            </div>              \n            <div class="opciones-unica">\n                <button type="button" class="cerrar-modal">Volver</button>\n            </div>\n        </form>\n    ',n}function modalUsuarios(e){const o=document.createElement("DIV");return o.classList.add("modal"),LeerApi("http://localhost:3000/usuarios_rol").then(l=>{o.innerHTML='\n            <form class="formulario" >\n                <legend>Usuario: '+e.usuario+'</legend>                \n                <div class="campo">\n                    <label class="subtitulo">Nombre</label>\n                    <input\n                        type= "text"\n                        name = "nombre"\n                        placeholder="Ingresa el nombre de usuario"\n                        value="'+e.nombre+'"\n                        id="nombre"\n                    />\n                </div>\n                <div class="campo">\n                    <label class="subtitulo">Apellido</label>\n                    <input\n                        type= "text"\n                        name = "apellido"\n                        placeholder="Ingresa el nombre de usuario"\n                        value="'+e.apellido+'"\n                        id="apellido"\n                    />\n                </div>\n                <div class="campo">\n                    <label class="subtitulo">Direccion</label>\n                    <input\n                        type= "text"\n                        name = "direccion"\n                        placeholder="Ingresa el nombre de usuario"\n                        value="'+e.direccion+'"\n                        id="direccion"\n                    />\n                </div>\n                <div class="campo">\n                    <label class="subtitulo">Usuario</label>\n                    <input\n                        type= "text"\n                        name = "usuario"\n                        placeholder="Ingresa el nombre de usuario"\n                        value="'+e.usuario+'"\n                        id="usuario"\n                    />\n                </div>\n                <div class="campo">\n                    <label class="subtitulo">Contraseña</label>\n                    <input\n                        type= "password"\n                        name = "psw"\n                        placeholder="Ingresa el nombre de usuario"\n                        value="'+e.psw+'"\n                        id="psw"\n                    />\n                </div>\n                <div class="campo">\n                    <label class="subtitulo">Rol</label>\n                    <select id="usuario-select">\n\n                    </select>\n                </div>\n                <div class="opciones">\n                    <input type="submit" class="submit-actualizar-usuario" value="Actualizar"/>\n                    <button type="button" class="cerrar-modal">Cancelar</button>\n                </div>\n            </form>\n        ';const t=o.querySelector("#usuario-select");l.rol.forEach(e=>{const o=document.createElement("option");o.value=e.id,o.text=e.nombre_rol,t.add(o)}),mostrarModal(o)}).catch(e=>{console.error(e)}),o}function modalNuevoUsuario(){const e=document.createElement("DIV");return e.classList.add("modal"),LeerApi("http://localhost:3000/usuarios_rol").then(o=>{e.innerHTML='\n            <form action="/usuarios" class="formulario">\n                <legend>Añadir nuevo Usuario</legend>\n                <div class="campo">\n                    <label class="subtitulo">Cedula</label>\n                    <input\n                        type= "number"\n                        name = "cedula"\n                        placeholder="Ingresa la cedula del usuario"\n                        id="cedula"\n                    />\n                </div>\n                <div class="campo">\n                    <label class="subtitulo">Nombre</label>\n                    <input\n                        type= "text"\n                        name = "nombre"\n                        placeholder="Ingresa el nombre del usuario"\n                        id="nombre"\n                    />\n                </div>\n                <div class="campo">\n                    <label class="subtitulo">Apellido</label>\n                    <input\n                        type= "text"\n                        name = "apellido"\n                        placeholder="Ingresa el apellido del usuario"\n                        id="apellido"\n                    />\n                </div>\n                <div class="campo">\n                    <label class="subtitulo">Direccion</label>\n                    <input\n                        type= "text"\n                        name = "direccion"\n                        placeholder="Ingresa la direccion del usuario"\n                        id="direccion"\n                    />\n                </div>\n                <div class="campo">\n                    <label class="subtitulo">Correo</label>\n                    <input\n                        type= "email"\n                        name = "correo"\n                        placeholder="Ingresa el correo del usuario"\n                        id="correo"\n                    />\n                </div>\n                <div class="campo">\n                    <label class="subtitulo">Usuario</label>\n                    <input\n                        type= "text"\n                        name = "usuario"\n                        placeholder="Ingresa el nombre de usuario"\n                        id="usuario"\n                    />\n                </div>\n                <div class="campo">\n                    <label class="subtitulo">Rol</label>\n                    <select id="usuario-select">\n                        \n                    </select>\n                </div>\n                <div class="campo">\n                    <label class="subtitulo">Password</label>\n                    <input\n                        type= "password"\n                        name = "psw"\n                        placeholder="Ingresa el password del usuario"\n                        id="psw"\n                    />\n                </div>\n                <div class="opciones">\n                    <input type="submit" class="submit-nuevo-usuario" value="Crear Usuario"/>\n                    <button type="button" class="cerrar-modal">Cancelar</button>\n                </div>\n            </form>            \n        ';const l=e.querySelector("#usuario-select");o.rol.forEach(e=>{const o=document.createElement("option");o.value=e.id,o.text=e.nombre_rol,l.add(o)}),mostrarModal(e)}).catch(e=>{console.error(e)}),e}function modalSalon(e,o,l){console.log(l);const t=document.createElement("DIV");t.classList.add("modal"),LeerApi("http://localhost:3000/bloques").then(n=>{t.innerHTML='\n            <form class="formulario">\n                <legend>Actualizar Salon</legend>\n                <div class="campo">\n                    <label class="subtitulo">Nombre del Salon</label>\n                    <input\n                        type= "text"\n                        name = "salon"\n                        placeholder="Ingresa el nombre del salon"\n                        value="'+e.salon+'"\n                        id="salon"\n                    />\n                </div>\n                <div class="campo">\n                    <label class="subtitulo">Bloque</label>\n                    <select id="bloque-select">\n\n                    </select>\n                </div>\n                \n                <div class="opciones">\n                    <input type="submit" class="submit-actualiza-salon" value="Actualizar Salon"/>\n                    <button type="button" class="cerrar-modal">Cancelar</button>\n                </div>\n            </form>\n            ';const a=t.querySelector("#bloque-select");return n.bloques.forEach(e=>{const o=document.createElement("option");o.value=e.id,o.text=e.nombre_bloque,l==e.nombre_bloque&&(o.selected=!0),a.add(o)}),mostrarModal(t,o),t}).catch(e=>{console.error(e)})}function modalBloque(e){const o=document.createElement("DIV");return o.classList.add("modal"),o.innerHTML='\n    <form class="formulario">\n            <legend>Actualizar Bloque</legend>\n            <div class="campo">\n                <label class="subtitulo">Nombre del Bloque</label>\n                <input\n                    type= "text"\n                    name = "bloque"\n                    placeholder="Ingresa el nombre del bloque"\n                    value="'+e.bloque+'"\n                    id="bloque"\n                />\n            </div>\n            <div class="opciones">\n                <input type="submit" class="submit-actualiza-bloque" value="Actualizar Bloque"/>\n                <button type="button" class="cerrar-modal">Cancelar</button>\n            </div>\n        </form>\n',o}function modalNuevoBloque(){const e=document.createElement("DIV");return e.classList.add("modal"),e.innerHTML='\n    <form class="formulario">\n            <legend>Agrega un nuevo Bloque</legend>\n            <div class="campo">\n                <label class="subtitulo">Nombre del Bloque</label>\n                <input\n                    type= "text"\n                    name = "bloque"\n                    placeholder="Ingresa el nombre del bloque"\n                    id="bloque"\n                />\n            </div>\n            <div class="opciones">\n                <input type="submit" class="submit-nuevo-bloque" value="Crear Bloque"/>\n                <button type="button" class="cerrar-modal">Cancelar</button>\n            </div>\n        </form>\n',e}function modalNuevoSalon(){const e=document.createElement("DIV");e.classList.add("modal"),LeerApi("http://localhost:3000/bloques").then(o=>{console.log(o.bloques),e.innerHTML='\n            <form class="formulario">\n                <legend>Añadir nuevo Salon</legend>\n                <div class="campo">\n                    <label class="subtitulo">Nombre del Salon</label>\n                    <input\n                        type= "text"\n                        name = "salon"\n                        placeholder="Ingresa el nombre del salon"\n                        id="salon"\n                    />\n                </div>\n                <div class="campo">\n                    <label class="subtitulo">Bloque</label>\n                    <select id="bloque-select">\n\n                    </select>\n                </div>\n                \n                <div class="opciones">\n                    <input type="submit" class="submit-nuevo-salon" value="Crear Salon"/>\n                    <button type="button" class="cerrar-modal">Cancelar</button>\n                </div>\n            </form>\n            ';const l=e.querySelector("#bloque-select");return o.bloques.forEach(e=>{const o=document.createElement("option");o.value=e.id,o.text=e.nombre_bloque,l.add(o)}),mostrarModal(e),e}).catch(e=>{console.error(e)})}async function submitNuevoSalon(){var e=0;const o=document.querySelector("#salon").value.trim().toUpperCase(),l=document.querySelector("#bloque-select").value.trim().toUpperCase();if(""!=o){const t=await fetch("http://localhost:3000/aulas_nombre/"+o+"&"+l),n=await t.json();e=Object.keys(n.aulas).length}if(e>0)mostrarAlertaAfter("El Salon ya existe","error",document.querySelector("legend"));else if(""!=o)if(/^[a-zA-Z0-9\s]*$/.test(o.toLowerCase())){var t={nombre_aulas:""+o,bloque_id:""+l};console.log(t),enviarDatosApi("http://localhost:3000/aulas",JSON.stringify(t))}else mostrarAlertaAfter("El texto debe iniciar con aula o laboratorio seguidos de un espacio","error",document.querySelector("legend"));else mostrarAlertaAfter("El nombre del salon no debe ir vacio","error",document.querySelector("legend"))}async function submitNuevoBloque(){var e=0;const o=document.querySelector("#bloque").value.trim().toUpperCase();if(""!=o){const l=await fetch("http://localhost:3000/bloque_nombre/"+o),t=await l.json();e=Object.keys(t.bloques).length,console.log(t),console.log("http://localhost:3000/bloque_nombre/"+o)}if(e>0)mostrarAlertaAfter("El Bloque ya existe","error",document.querySelector("legend"));else if(""!=o)if(/^[a-zA-Z]$/.test(o.toUpperCase())){var l={nombre_bloques:""+o};console.log(l),enviarDatosApi("http://localhost:3000/bloques",JSON.stringify(l))}else mostrarAlertaAfter("El nombre del bloque solo es una letra","error",document.querySelector("legend"));else mostrarAlertaAfter("El nombre del Bloque no debe ir vacio","error",document.querySelector("legend"))}async function submitActualizarSalon(e){var o=0;const l=document.querySelector("#salon").value.trim().toUpperCase(),t=document.querySelector("#bloque-select").value.trim().toUpperCase();if(console.log(l),""!=l){const e=await fetch("http://localhost:3000/aulas_nombre/"+l+"&"+t),n=await e.json();o=Object.keys(n.aulas).length}if(o>0)mostrarAlertaAfter("El Salon ya existe","error",document.querySelector("legend"));else if(""!=l)if(/^[a-zA-Z0-9\s]*$/.test(l.toLowerCase())){var n={nombre_aulas:""+l,bloque_id:""+t};console.log(n);var a=JSON.stringify(n);console.log(a),enviarDatosApi("http://localhost:3000/aulas/"+e,a,"PUT")}else mostrarAlertaAfter("El texto debe iniciar con aula o laboratorio seguidos de un espacio","error",document.querySelector("legend"));else mostrarAlertaAfter("El nombre del salon no debe ir vacio","error",document.querySelector("legend"))}async function submitActualizarBloque(e){const o=document.querySelector("#bloque").value.trim().toUpperCase();if(""!=o){const e=await fetch("http://localhost:3000/bloque_nombre/"+o),l=await e.json();cantidad=Object.keys(l.bloques).length,console.log(l),console.log("http://localhost:3000/bloque_nombre/"+o)}if(cantidad>0)mostrarAlertaAfter("El Bloque ya existe","error",document.querySelector("legend"));else if(""!=o)if(/^[a-zA-Z]$/.test(o.toLowerCase())){var l={nombre_bloques:""+o},t=JSON.stringify(l);console.log(t),enviarDatosApi("http://localhost:3000/bloques/"+e,t,"PUT")}else mostrarAlertaAfter("El nombre del bloque solo es una letra","error",document.querySelector("legend"));else mostrarAlertaAfter("El nombre del bloque no debe ir vacio","error",document.querySelector("legend"))}function animar(){setTimeout(()=>{document.querySelector(".formulario").classList.add("animar")},100)}function mostrarModal(e,o=""){animar(),e.addEventListener("click",(function(l){if(l.preventDefault(),console.log(o),l.target.classList.contains("cerrar-modal")){document.querySelector(".formulario").classList.add("cerrar"),setTimeout(()=>{e.remove()},500)}l.target.classList.contains("submit-actualizar-usuario")&&submitActualizarUsuario(o),l.target.classList.contains("submit-nuevo-usuario")&&submitNuevaUsuario(),l.target.classList.contains("submit-nuevo-salon")&&submitNuevoSalon(),l.target.classList.contains("submit-actualiza-bloque")&&submitActualizarBloque(o),l.target.classList.contains("submit-nuevo-bloque")&&submitNuevoBloque(o),l.target.classList.contains("submit-actualiza-salon")&&submitActualizarSalon(o)})),document.querySelector(".dashboard").appendChild(e)}async function submitActualizarUsuario(e){console.log("aqui");var o=/^[a-zA-Z\s]+$/;const l=document.querySelector("#nombre").value.trim().toLowerCase(),t=document.querySelector("#apellido").value.trim().toLowerCase(),n=document.querySelector("#direccion").value.trim().toLowerCase(),a=document.querySelector("#usuario-select").value.trim().toLowerCase(),r=document.querySelector("#usuario").value.trim(),s=document.querySelector("#psw").value.trim();if(""==r||""==s)return void mostrarAlertaAfter("El usuario y el password no puede ir vacio","error",document.querySelector("legend"));if(!n)return void mostrarAlertaAfter("La direccion no puede ir vacia","error",document.querySelector("legend"));if(!/^[a-zA-Z0-9\s,'-]*$/.test(n))return void mostrarAlertaAfter("Direccion no valida","error",document.querySelector("legend"));if(!o.test(l))return void mostrarAlertaAfter("El nombre solo debe contener letras","error",document.querySelector("legend"));if(!o.test(t))return void mostrarAlertaAfter("El apellido solo debe contener letras","error",document.querySelector("legend"));var i={nombre:""+l,apellido:""+t,direccion:""+n,rol_id:""+a,usuario:""+r,psw:""+s};enviarDatosApi("http://localhost:3000/usuarios/"+e,JSON.stringify(i),"PUT")}async function submitNuevaUsuario(){var e=0,o=/^[a-zA-Z\s]+$/;const l=document.querySelector("#cedula").value.trim(),t=document.querySelector("#nombre").value.trim().toLowerCase(),n=document.querySelector("#apellido").value.trim().toLowerCase(),a=document.querySelector("#direccion").value.trim().toLowerCase(),r=document.querySelector("#correo").value.trim().toLowerCase(),s=document.querySelector("#usuario-select").value,i=document.querySelector("#usuario").value.trim(),u=document.querySelector("#psw").value.trim();if(""!=r||""!=l){const o=await fetch("http://localhost:3000/usuarios2/"+r+"&"+l),t=await o.json();e=Object.keys(t.usuario).length}if(e>0)mostrarAlertaAfter("El usuario que esta creando ya existe","error",document.querySelector("legend"));else if(l)if(a)if(/^[a-zA-Z0-9\s,'-]*$/.test(a))if(""!=i&&""!=u&&""!=r)if("ninguno"!=s)if(o.test(i))if(/@ups\.edu\.ec$/.test(r))if(o.test(t))if(o.test(n)){var c={cedula:""+l,correo:""+r,nombre:""+t,apellido:""+n,direccion:""+a,rol_id:""+s,usuario:""+i,psw:""+u},d=JSON.stringify(c);console.log(d),enviarDatosApi("http://localhost:3000/usuarios",d)}else mostrarAlertaAfter("El apellido solo debe contener letras","error",document.querySelector("legend"));else mostrarAlertaAfter("El nombre solo debe contener letras","error",document.querySelector("legend"));else mostrarAlertaAfter("El correo debe contener '@ups.edu.ec'","error",document.querySelector("legend"));else mostrarAlertaAfter("El usuario solo debe contener letras","error",document.querySelector("legend"));else mostrarAlertaAfter("Debe elegir un rol","error",document.querySelector("legend"));else mostrarAlertaAfter("El usuario, password y el correo no puede ir vacio","error",document.querySelector("legend"));else mostrarAlertaAfter("Direccion no valida","error",document.querySelector("legend"));else mostrarAlertaAfter("La direccion no puede ir vacia","error",document.querySelector("legend"));else mostrarAlertaAfter("La cedula ","error",document.querySelector("legend"))}async function enviarDatosApi(e,o,l="POST"){try{const t=await fetch(e,{method:l,headers:{"Content-Type":"application/json"},body:o}),n=await t.json();return console.log(n),"Updated"==n.message?alert("Actualizado"):"Saved"==n.message&&alert("Creado"),void location.reload()}catch(e){console.log(e)}}async function consultaApi(e,o){const l=await fetch(e,{method:"POST",body:o});return await l.json()}async function LeerApi(e){const o=await fetch(e),l=await o.json();JSON.stringify(l);return l}function mostrarAlertaAfter(e,o,l){const t=document.querySelector(".alerta");t&&t.remove();const n=document.createElement("DIV");n.classList.add("alerta",o),n.textContent=e,l.parentElement.insertBefore(n,l.nextElementSibling),setTimeout(()=>{n.remove()},5e3)}function mostrarAlertaBefore(e,o,l){const t=document.querySelector(".alerta");t&&t.remove();const n=document.createElement("DIV");n.classList.add("alerta",o),n.textContent=e,l.parentElement.insertBefore(n,l),setTimeout(()=>{n.remove()},5e3)}bloques.forEach(e=>{e.addEventListener("click",(function(o){EnvioId(e.querySelector(".id").innerHTML.trim(),"http://localhost:3001/bloque")}))});