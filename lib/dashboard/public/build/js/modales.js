const solicitudes=document.querySelectorAll(".solicitudes");solicitudes.forEach(e=>{e.addEventListener("click",(function(o){EnvioId(e.querySelector(".id").innerHTML.trim(),"http://localhost:3001/solicitudes")}))});const usuarios=document.querySelectorAll(".usuarios");usuarios.forEach(e=>{e.addEventListener("click",(function(o){EnvioId(e.querySelector(".id").innerHTML.trim(),"http://localhost:3001/usuario")}))});const salones=document.querySelectorAll(".salones");salones.forEach(e=>{e.addEventListener("click",(function(o){EnvioId(e.querySelector(".id").innerHTML.trim(),"http://localhost:3001/salon")}))});const bloques=document.querySelectorAll(".bloques");function envioUsuario(){mostrarModal(modalNuevoUsuario())}function envioSalon(){modalNuevoSalon()}function envioBloque(){mostrarModal(modalNuevoBloque())}function EnvioId(e,o){if(null!==e){var l=new FormData;l.append("id",e)}try{consultaApi(o,l).then((function(e){if("soporte"==e.remitente)var o=modalServicios(e);else if("docente"==e.remitente)o=modalUsuarios(e);else if("salon"==e.remitente){console.log(e.bloque);o=modalSalon(e,e.id,e.bloque)}else if("bloque"==e.remitente){console.log(e);o=modalBloque(e)}mostrarModal(o,e.id)}))}catch(e){console.log(e)}}function modalServicios(e){var o;if("terminado"===e.estado){var l="completa";o=e.fecha_final}else if("en_camino"===e.estado){l="camino";o=e.fecha_final}else{l="pendiente";o=e.fecha_inicial}const t=new Date(o).toLocaleDateString("es-ES"),a=document.createElement("DIV");a.classList.add("modal");var n="en_camino"===e.estado?"En Camino":e.estado;return a.innerHTML='\n        <form class="formulario"> \n            <div class="contenedor-titulo">\n            <legend class="">Solicitud '+n+' </legend> \n            <div class="imagen-estado '+l+'"></div>\n            </div>          \n            <div class="campo">\n                <label class="subtitulo" >Tipo:</label>\n                <label>'+e.tipo+'</label>\n            </div>\n            <div class="campo">\n                <label class="subtitulo">Bloque:</label>\n                <label>'+e.bloque+'</label>\n            </div>\n            <div class="campo">\n                <label class="subtitulo">Aula:</label>\n                <label>'+e.aula+'</label>\n            </div>\n            <div class="campo">\n                <label class="subtitulo">Usuario:</label>\n                <label>'+e.usuario+'</label>\n            </div>\n            <div class="campo">\n                <label class="subtitulo">Detalle:</label>\n                <label>'+e.detalle+'</label>\n            </div>     \n            <div class="campo">\n                <label class="subtitulo">Detalle:</label>\n                <label>'+t+'</label>\n            </div>              \n            <div class="opciones-unica">\n                <button type="button" class="cerrar-modal">Volver</button>\n            </div>\n        </form>\n    ',a}function modalUsuarios(e){var o="",l="";"docente"==e.rol?o="selected":l="selected";const t=document.createElement("DIV");return t.classList.add("modal"),t.innerHTML='\n        <form class="formulario" >\n                <legend>Usuario: '+e.usuario+'</legend>\n                <div class="campo">\n                    <label class="subtitulo">Usuario</label>\n                    <input\n                        type= "text"\n                        name = "usuario"\n                        placeholder="Ingresa el nombre de usuario"\n                        value="'+e.usuario+'"\n                        id="usuario"\n                    />\n                </div>\n                <div class="campo">\n                    <label class="subtitulo">Usuario</label>\n                    <input\n                        type= "password"\n                        name = "psw"\n                        placeholder="Ingresa el nombre de usuario"\n                        value="'+e.psw+'"\n                        id="psw"\n                    />\n                </div>\n                <div class="campo">\n                    <label class="subtitulo">Rol</label>\n                    <select id="rol">\n                        <option '+o+' value="docente">Docente</option>\n                        <option '+l+' value="soporte">Soporte</option>\n                    </select>\n                </div>\n                <div class="opciones">\n                    <input type="submit" class="submit-actualizar-usuario" value="Actualizar"/>\n                    <button type="button" class="cerrar-modal">Cancelar</button>\n                </div>\n            </form>\n    ',t}function modalNuevoUsuario(){const e=document.createElement("DIV");return e.classList.add("modal"),e.innerHTML='\n        <form action="/usuarios" class="formulario">\n                <legend>Añadir nuevo Usuario</legend>\n                <div class="campo">\n                    <label class="subtitulo">Correo</label>\n                    <input\n                        type= "email"\n                        name = "correo"\n                        placeholder="Ingresa el correo del usuario"\n                        id="correo"\n                    />\n                </div>\n                <div class="campo">\n                    <label class="subtitulo">Usuario</label>\n                    <input\n                        type= "text"\n                        name = "usuario"\n                        placeholder="Ingresa el nombre de usuario"\n                        id="usuario"\n                    />\n                </div>\n                <div class="campo">\n                    <label class="subtitulo">Rol</label>\n                    <select id="rol">\n                        <option value="ninguno">--Selecciona un Rol--</option>\n                        <option value="docente">Docente</option>\n                        <option value="soporte">Soporte</option>\n                    </select>\n                </div>\n                <div class="campo">\n                    <label class="subtitulo">Password</label>\n                    <input\n                        type= "password"\n                        name = "psw"\n                        placeholder="Ingresa el password del usuario"\n                        id="psw"\n                    />\n                </div>\n                <div class="opciones">\n                    <input type="submit" class="submit-nuevo-usuario" value="Crear Usuario"/>\n                    <button type="button" class="cerrar-modal">Cancelar</button>\n                </div>\n            </form>\n    ',e}function modalSalon(e,o,l){console.log(l);const t=document.createElement("DIV");t.classList.add("modal"),LeerApi("http://localhost:3000/bloques").then(a=>{t.innerHTML='\n            <form class="formulario">\n                <legend>Actualizar Salon</legend>\n                <div class="campo">\n                    <label class="subtitulo">Nombre del Salon</label>\n                    <input\n                        type= "text"\n                        name = "salon"\n                        placeholder="Ingresa el nombre del salon"\n                        value="'+e.salon+'"\n                        id="salon"\n                    />\n                </div>\n                <div class="campo">\n                    <label class="subtitulo">Bloque</label>\n                    <select id="bloque-select">\n\n                    </select>\n                </div>\n                \n                <div class="opciones">\n                    <input type="submit" class="submit-actualiza-salon" value="Actualizar Salon"/>\n                    <button type="button" class="cerrar-modal">Cancelar</button>\n                </div>\n            </form>\n            ';const n=t.querySelector("#bloque-select");return a.bloques.forEach(e=>{const o=document.createElement("option");o.value=e.id,o.text=e.nombre_bloque,l==e.nombre_bloque&&(o.selected=!0),n.add(o)}),mostrarModal(t,o),t}).catch(e=>{console.error(e)})}function modalBloque(e){const o=document.createElement("DIV");return o.classList.add("modal"),o.innerHTML='\n    <form class="formulario">\n            <legend>Actualizar Bloque</legend>\n            <div class="campo">\n                <label class="subtitulo">Nombre del Bloque</label>\n                <input\n                    type= "text"\n                    name = "bloque"\n                    placeholder="Ingresa el nombre del bloque"\n                    value="'+e.bloque+'"\n                    id="bloque"\n                />\n            </div>\n            <div class="opciones">\n                <input type="submit" class="submit-actualiza-bloque" value="Actualizar Bloque"/>\n                <button type="button" class="cerrar-modal">Cancelar</button>\n            </div>\n        </form>\n',o}function modalNuevoBloque(){const e=document.createElement("DIV");return e.classList.add("modal"),e.innerHTML='\n    <form class="formulario">\n            <legend>Agrega un nuevo Bloque</legend>\n            <div class="campo">\n                <label class="subtitulo">Nombre del Bloque</label>\n                <input\n                    type= "text"\n                    name = "bloque"\n                    placeholder="Ingresa el nombre del bloque"\n                    id="bloque"\n                />\n            </div>\n            <div class="opciones">\n                <input type="submit" class="submit-nuevo-bloque" value="Crear Bloque"/>\n                <button type="button" class="cerrar-modal">Cancelar</button>\n            </div>\n        </form>\n',e}function modalNuevoSalon(){const e=document.createElement("DIV");e.classList.add("modal"),LeerApi("http://localhost:3000/bloques").then(o=>{console.log(o.bloques),e.innerHTML='\n            <form class="formulario">\n                <legend>Añadir nuevo Salon</legend>\n                <div class="campo">\n                    <label class="subtitulo">Nombre del Salon</label>\n                    <input\n                        type= "text"\n                        name = "salon"\n                        placeholder="Ingresa el nombre del salon"\n                        id="salon"\n                    />\n                </div>\n                <div class="campo">\n                    <label class="subtitulo">Bloque</label>\n                    <select id="bloque-select">\n\n                    </select>\n                </div>\n                \n                <div class="opciones">\n                    <input type="submit" class="submit-nuevo-salon" value="Crear Salon"/>\n                    <button type="button" class="cerrar-modal">Cancelar</button>\n                </div>\n            </form>\n            ';const l=e.querySelector("#bloque-select");return o.bloques.forEach(e=>{const o=document.createElement("option");o.value=e.id,o.text=e.nombre_bloque,l.add(o)}),mostrarModal(e),e}).catch(e=>{console.error(e)})}async function submitNuevoSalon(){var e=0;const o=document.querySelector("#salon").value.trim().toUpperCase(),l=document.querySelector("#bloque-select").value.trim().toUpperCase();if(""!=o){const t=await fetch("http://localhost:3000/aulas_nombre/"+o+"&"+l),a=await t.json();e=Object.keys(a.aulas).length}if(e>0)mostrarAlertaAfter("El Salon ya existe","error",document.querySelector("legend"));else if(""!=o)if(/^(laboratorio|aula)\s[\w\s]*$/.test(o.toLowerCase())){var t={nombre_aulas:""+o,bloque_id:""+l};console.log(t),enviarDatosApi("http://localhost:3000/aulas",JSON.stringify(t))}else mostrarAlertaAfter("El texto debe iniciar con aula o laboratorio seguidos de un espacio","error",document.querySelector("legend"));else mostrarAlertaAfter("El nombre del salon no debe ir vacio","error",document.querySelector("legend"))}async function submitNuevoBloque(){var e=0;const o=document.querySelector("#bloque").value.trim().toUpperCase();if(""!=o){const l=await fetch("http://localhost:3000/bloque_nombre/"+o),t=await l.json();e=Object.keys(t.bloques).length,console.log(t),console.log("http://localhost:3000/bloque_nombre/"+o)}if(e>0)mostrarAlertaAfter("El Bloque ya existe","error",document.querySelector("legend"));else if(""!=o)if(/^[a-zA-Z]$/.test(o.toUpperCase())){var l={nombre_bloques:""+o};console.log(l),enviarDatosApi("http://localhost:3000/bloques",JSON.stringify(l))}else mostrarAlertaAfter("El nombre del bloque solo es una letra","error",document.querySelector("legend"));else mostrarAlertaAfter("El nombre del Bloque no debe ir vacio","error",document.querySelector("legend"))}async function submitActualizarSalon(e){var o=0;const l=document.querySelector("#salon").value.trim().toUpperCase(),t=document.querySelector("#bloque-select").value.trim().toUpperCase();if(console.log(l),""!=l){const e=await fetch("http://localhost:3000/aulas_nombre/"+l+"&"+t),a=await e.json();o=Object.keys(a.aulas).length}if(o>0)mostrarAlertaAfter("El Salon ya existe","error",document.querySelector("legend"));else if(""!=l)if(/^(laboratorio|aula)\s[\w\s]*$/.test(l.toLowerCase())){var a={nombre_aulas:""+l,bloque_id:""+t};console.log(a);var n=JSON.stringify(a);console.log(n),enviarDatosApi("http://localhost:3000/aulas/"+e,n,"PUT")}else mostrarAlertaAfter("El texto debe iniciar con aula o laboratorio seguidos de un espacio","error",document.querySelector("legend"));else mostrarAlertaAfter("El nombre del salon no debe ir vacio","error",document.querySelector("legend"))}async function submitActualizarBloque(e){const o=document.querySelector("#bloque").value.trim().toUpperCase();if(""!=o){const e=await fetch("http://localhost:3000/bloque_nombre/"+o),l=await e.json();cantidad=Object.keys(l.bloques).length,console.log(l),console.log("http://localhost:3000/bloque_nombre/"+o)}if(cantidad>0)mostrarAlertaAfter("El Bloque ya existe","error",document.querySelector("legend"));else if(""!=o)if(/^[a-zA-Z]$/.test(o.toLowerCase())){var l={nombre_bloques:""+o},t=JSON.stringify(l);console.log(t),enviarDatosApi("http://localhost:3000/bloques/"+e,t,"PUT")}else mostrarAlertaAfter("El nombre del bloque solo es una letra","error",document.querySelector("legend"));else mostrarAlertaAfter("El nombre del bloque no debe ir vacio","error",document.querySelector("legend"))}function animar(){setTimeout(()=>{document.querySelector(".formulario").classList.add("animar")},100)}function mostrarModal(e,o=""){animar(),e.addEventListener("click",(function(l){if(l.preventDefault(),console.log(o),l.target.classList.contains("cerrar-modal")){document.querySelector(".formulario").classList.add("cerrar"),setTimeout(()=>{e.remove()},500)}l.target.classList.contains("submit-actualizar-usuario")&&submitActualizarUsuario(o),l.target.classList.contains("submit-nuevo-usuario")&&submitNuevaUsuario(),l.target.classList.contains("submit-nuevo-salon")&&submitNuevoSalon(),l.target.classList.contains("submit-actualiza-bloque")&&submitActualizarBloque(o),l.target.classList.contains("submit-nuevo-bloque")&&submitNuevoBloque(o),l.target.classList.contains("submit-actualiza-salon")&&submitActualizarSalon(o)})),document.querySelector(".dashboard").appendChild(e)}async function submitActualizarUsuario(e){console.log("aqui");const o=document.querySelector("#rol").value.trim().toLowerCase(),l=document.querySelector("#usuario").value.trim(),t=document.querySelector("#psw").value.trim();if(""==l||""==t)return void mostrarAlertaAfter("El usuario y el password no puede ir vacio","error",document.querySelector("legend"));if(!/^[a-zA-Z\s]+$/.test(l))return void mostrarAlertaAfter("El usuario solo debe contener letras","error",document.querySelector("legend"));var a={rol:""+o,usuario:""+l,psw:""+t};enviarDatosApi("http://localhost:3000/usuarios/"+e,JSON.stringify(a),"PUT")}async function submitNuevaUsuario(){var e=0;const o=document.querySelector("#correo").value.trim().toLowerCase(),l=document.querySelector("#rol").value.trim().toLowerCase(),t=document.querySelector("#usuario").value.trim(),a=document.querySelector("#psw").value.trim();if(""!=o){const l=await fetch("http://localhost:3000/usuarios2/"+o),t=await l.json();e=Object.keys(t.usuario).length}if(e>0)mostrarAlertaAfter("El usuario ya existe","error",document.querySelector("legend"));else if(""!=t&&""!=a&&""!=o)if("ninguno"!=l)if(/^[a-zA-Z\s]+$/.test(t))if(/@ups\.edu\.ec$/.test(o)){console.log(!1);var n={correo:""+o,rol:""+l,usuario:""+t,psw:""+a};enviarDatosApi("http://localhost:3000/usuarios",JSON.stringify(n))}else mostrarAlertaAfter("El correo debe contener '@ups.edu.ec'","error",document.querySelector("legend"));else mostrarAlertaAfter("El usuario solo debe contener letras","error",document.querySelector("legend"));else mostrarAlertaAfter("Debe elegir un rol","error",document.querySelector("legend"));else mostrarAlertaAfter("El usuario, password y el correo no puede ir vacio","error",document.querySelector("legend"))}async function enviarDatosApi(e,o,l="POST"){try{const t=await fetch(e,{method:l,headers:{"Content-Type":"application/json"},body:o}),a=await t.json();return console.log(a),"Updated"==a.message?alert("Actualizado"):"Saved"==a.message&&alert("Creado"),void location.reload()}catch(e){console.log(e)}}async function consultaApi(e,o){const l=await fetch(e,{method:"POST",body:o});return await l.json()}async function LeerApi(e){const o=await fetch(e),l=await o.json();JSON.stringify(l);return l}function mostrarAlertaAfter(e,o,l){const t=document.querySelector(".alerta");t&&t.remove();const a=document.createElement("DIV");a.classList.add("alerta",o),a.textContent=e,l.parentElement.insertBefore(a,l.nextElementSibling),setTimeout(()=>{a.remove()},5e3)}function mostrarAlertaBefore(e,o,l){const t=document.querySelector(".alerta");t&&t.remove();const a=document.createElement("DIV");a.classList.add("alerta",o),a.textContent=e,l.parentElement.insertBefore(a,l),setTimeout(()=>{a.remove()},5e3)}bloques.forEach(e=>{e.addEventListener("click",(function(o){EnvioId(e.querySelector(".id").innerHTML.trim(),"http://localhost:3001/bloque")}))});