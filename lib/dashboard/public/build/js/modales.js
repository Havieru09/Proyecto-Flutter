const solicitudes=document.querySelectorAll(".solicitudes");solicitudes.forEach(e=>{e.addEventListener("click",(function(o){EnvioId(e.querySelector(".id").innerHTML.trim(),"http://localhost:3001/dashboard")}))});const usuarios=document.querySelectorAll(".usuarios");usuarios.forEach(e=>{e.addEventListener("click",(function(o){EnvioId(e.querySelector(".id").innerHTML.trim(),"http://localhost:3001/usuario")}))});const salones=document.querySelectorAll(".salones");function envioUsuario(){mostrarModal(modalNuevoUsuario())}function envioSalon(){mostrarModal(modalNuevoSalon())}function EnvioId(e,o){if(null!==e){var n=new FormData;n.append("id",e)}try{consultaApi(o,n).then((function(e){if("soporte"==e.remitente)var o=modalServicios(e);else if("docente"==e.remitente)o=modalUsuarios(e);else if("salon"==e.remitente)o=modalSalon(e);mostrarModal(o,e.id)}))}catch(e){console.log(e)}}function modalServicios(e){if("terminado"===e.estado)var o="completa";else if("en_camino"===e.estado)o="camino";else o="pendiente";const n=document.createElement("DIV");n.classList.add("modal");var a="en_camino"===e.estado?"En Camino":e.estado;return n.innerHTML='\n        <form class="formulario"> \n            <div class="contenedor-titulo">\n            <legend class="">Solicitud '+a+' </legend> \n            <div class="imagen-estado '+o+'"></div>\n            </div>          \n            <div class="campo">\n                <label class="subtitulo" >Tipo:</label>\n                <label>'+e.tipo+'</label>\n            </div>\n            <div class="campo">\n                <label class="subtitulo">Bloque:</label>\n                <label>'+e.bloque+'</label>\n            </div>\n            <div class="campo">\n                <label class="subtitulo">Aula:</label>\n                <label>'+e.aula+'</label>\n            </div>\n            <div class="campo">\n                <label class="subtitulo">Usuario:</label>\n                <label>'+e.usuario+'</label>\n            </div>\n            <div class="campo">\n                <label class="subtitulo">Detalle:</label>\n                <label>'+e.detalle+'</label>\n            </div>                \n            <div class="opciones-unica">\n                <button type="button" class="cerrar-modal">Volver</button>\n            </div>\n        </form>\n    ',n}function modalUsuarios(e){var o="",n="";"docente"==e.rol?o="selected":n="selected";const a=document.createElement("DIV");return a.classList.add("modal"),a.innerHTML='\n        <form class="formulario" >\n                <legend>Usuario: '+e.usuario+'</legend>\n                <div class="campo">\n                    <label class="subtitulo">Usuario</label>\n                    <input\n                        type= "text"\n                        name = "usuario"\n                        placeholder="Ingresa el nombre de usuario"\n                        value="'+e.usuario+'"\n                        id="usuario"\n                    />\n                </div>\n                <div class="campo">\n                    <label class="subtitulo">Usuario</label>\n                    <input\n                        type= "password"\n                        name = "psw"\n                        placeholder="Ingresa el nombre de usuario"\n                        value="'+e.psw+'"\n                        id="psw"\n                    />\n                </div>\n                <div class="campo">\n                    <label class="subtitulo">Rol</label>\n                    <select id="rol">\n                        <option '+o+' value="docente">Docente</option>\n                        <option '+n+' value="soporte">Soporte</option>\n                    </select>\n                </div>\n                <div class="opciones">\n                    <input type="submit" class="submit-actualizar-usuario" value="Actualizar"/>\n                    <button type="button" class="cerrar-modal">Cancelar</button>\n                </div>\n            </form>\n    ',a}function modalNuevoUsuario(){const e=document.createElement("DIV");return e.classList.add("modal"),e.innerHTML='\n        <form action="/usuarios" class="formulario">\n                <legend>A単adir nuevo Usuario</legend>\n                <div class="campo">\n                    <label class="subtitulo">Correo</label>\n                    <input\n                        type= "email"\n                        name = "correo"\n                        placeholder="Ingresa el correo del usuario"\n                        id="correo"\n                    />\n                </div>\n                <div class="campo">\n                    <label class="subtitulo">Usuario</label>\n                    <input\n                        type= "text"\n                        name = "usuario"\n                        placeholder="Ingresa el nombre de usuario"\n                        id="usuario"\n                    />\n                </div>\n                <div class="campo">\n                    <label class="subtitulo">Rol</label>\n                    <select id="rol">\n                        <option value="ninguno">--Selecciona un Rol--</option>\n                        <option value="docente">Docente</option>\n                        <option value="soporte">Soporte</option>\n                    </select>\n                </div>\n                <div class="campo">\n                    <label class="subtitulo">Password</label>\n                    <input\n                        type= "password"\n                        name = "psw"\n                        placeholder="Ingresa el password del usuario"\n                        id="psw"\n                    />\n                </div>\n                <div class="opciones">\n                    <input type="submit" class="submit-nuevo-usuario" value="Crear Usuario"/>\n                    <button type="button" class="cerrar-modal">Cancelar</button>\n                </div>\n            </form>\n    ',e}function modalSalon(e){const o=document.createElement("DIV");return o.classList.add("modal"),o.innerHTML='\n    <form class="formulario">\n            <legend>A単adir nuevo Salon</legend>\n            <div class="campo">\n                <label class="subtitulo">Nombre del Salon</label>\n                <input\n                    type= "text"\n                    name = "salon"\n                    placeholder="Ingresa el nombre del salon"\n                    value="'+e.salon+'"\n                    id="salon"\n                />\n            </div>\n            <div class="opciones">\n                <input type="submit" class="submit-actualiza-salon" value="Actualizar Salon"/>\n                <button type="button" class="cerrar-modal">Cancelar</button>\n            </div>\n        </form>\n',o}function modalNuevoSalon(){const e=document.createElement("DIV");return e.classList.add("modal"),e.innerHTML='\n    <form class="formulario">\n            <legend>A単adir nuevo Salon</legend>\n            <div class="campo">\n                <label class="subtitulo">Nombre del Salon</label>\n                <input\n                    type= "text"\n                    name = "salon"\n                    placeholder="Ingresa el nombre del salon"\n                    id="salon"\n                />\n            </div>\n            <div class="opciones">\n                <input type="submit" class="submit-nuevo-salon" onclick="submitNuevoSalon()" value="Crear Salon"/>\n                <button type="button" class="cerrar-modal">Cancelar</button>\n            </div>\n        </form>\n',e}async function submitNuevoSalon(){const e=document.querySelector("#salon").value.trim().toUpperCase();if(""!=e)if(/^(laboratorio|aula)\s[\w\s]*$/.test(e.toLowerCase())){var o={nombre_aulas:""+e};console.log(o),enviarDatosApi("http://localhost:3000/aulas",JSON.stringify(o))}else mostrarAlertaAfter("El texto debe iniciar con aula o laboratorio seguidos de un espacio","error",document.querySelector("legend"));else mostrarAlertaAfter("El nombre del salon no debe ir vacio","error",document.querySelector("legend"))}async function submitActualizarSalon(e){const o=document.querySelector("#salon").value.trim().toUpperCase();if(""!=o)if(/^(laboratorio|aula)\s[\w\s]*$/.test(o.toLowerCase())){var n={nombre_aulas:""+o};console.log(n);var a=JSON.stringify(n);console.log(a),enviarDatosApi("http://localhost:3000/aulas/"+e,a,"PUT")}else mostrarAlertaAfter("El texto debe iniciar con aula o laboratorio seguidos de un espacio","error",document.querySelector("legend"));else mostrarAlertaAfter("El nombre del salon no debe ir vacio","error",document.querySelector("legend"))}function modalNuevoSalon(){const e=document.createElement("DIV");return e.classList.add("modal"),e.innerHTML='\n        <form class="formulario">\n                <legend>A単adir nuevo Salon</legend>\n                <div class="campo">\n                    <label class="subtitulo">Nombre del Salon</label>\n                    <input\n                        type= "text"\n                        name = "salon"\n                        placeholder="Ingresa el nombre del salon"\n                        id="salon"\n                    />\n                </div>\n                <div class="opciones">\n                    <input type="submit" class="submit-nuevo-salon" value="Crear Salon"/>\n                    <button type="button" class="cerrar-modal">Cancelar</button>\n                </div>\n            </form>\n    ',e}function animar(){setTimeout(()=>{document.querySelector(".formulario").classList.add("animar")},100)}function mostrarModal(e,o=""){animar(),e.addEventListener("click",(function(n){if(n.preventDefault(),n.target.classList.contains("cerrar-modal")){document.querySelector(".formulario").classList.add("cerrar"),setTimeout(()=>{e.remove()},500)}n.target.classList.contains("submit-actualizar-usuario")&&submitActualizarUsuario(o),n.target.classList.contains("submit-nuevo-usuario")&&submitNuevaUsuario(),n.target.classList.contains("submit-nuevo-salon")&&submitNuevoSalon(),n.target.classList.contains("submit-actualiza-salon")&&submitActualizarSalon(o)})),document.querySelector(".dashboard").appendChild(e)}async function submitActualizarUsuario(e){console.log("aqui");const o=document.querySelector("#rol").value.trim().toLowerCase(),n=document.querySelector("#usuario").value.trim(),a=document.querySelector("#psw").value.trim();if(""==n||""==a)return void mostrarAlertaAfter("El usuario y el password no puede ir vacio","error",document.querySelector("legend"));if(!/^[a-zA-Z\s]+$/.test(n))return void mostrarAlertaAfter("El usuario solo debe contener letras","error",document.querySelector("legend"));var t={rol:""+o,usuario:""+n,psw:""+a};enviarDatosApi("http://localhost:3000/usuarios/"+e,JSON.stringify(t),"PUT")}async function submitNuevaUsuario(){var e=0;const o=document.querySelector("#correo").value.trim().toLowerCase(),n=document.querySelector("#rol").value.trim().toLowerCase(),a=document.querySelector("#usuario").value.trim(),t=document.querySelector("#psw").value.trim();if(""!=o){const n=await fetch("http://localhost:3000/usuarios2/"+o),a=await n.json();e=Object.keys(a.usuario).length}if(e>0)mostrarAlertaAfter("El usuario ya existe","error",document.querySelector("legend"));else if(""!=a&&""!=t&&""!=o)if("ninguno"!=n)if(/^[a-zA-Z\s]+$/.test(a))if(/@ups\.edu\.ec$/.test(o)){console.log(!1);var l={correo:""+o,rol:""+n,usuario:""+a,psw:""+t};enviarDatosApi("http://localhost:3000/usuarios",JSON.stringify(l))}else mostrarAlertaAfter("El correo debe contener '@ups.edu.ec'","error",document.querySelector("legend"));else mostrarAlertaAfter("El usuario solo debe contener letras","error",document.querySelector("legend"));else mostrarAlertaAfter("Debe elegir un rol","error",document.querySelector("legend"));else mostrarAlertaAfter("El usuario, password y el correo no puede ir vacio","error",document.querySelector("legend"))}async function enviarDatosApi(e,o,n="POST"){console.log("aqui");try{const a=await fetch(e,{method:n,headers:{"Content-Type":"application/json"},body:o}),t=await a.json();return console.log(t),"Updated"==t.message?alert("Actualizado"):"Saved"==t.message&&alert("Usuario Creado"),void location.reload()}catch(e){console.log(e)}}async function consultaApi(e,o){const n=await fetch(e,{method:"POST",body:o});return await n.json()}async function LeerApi(e){const o=await fetch(e);return await o.json()}function mostrarAlertaAfter(e,o,n){const a=document.querySelector(".alerta");a&&a.remove();const t=document.createElement("DIV");t.classList.add("alerta",o),t.textContent=e,n.parentElement.insertBefore(t,n.nextElementSibling),setTimeout(()=>{t.remove()},5e3)}function mostrarAlertaBefore(e,o,n){const a=document.querySelector(".alerta");a&&a.remove();const t=document.createElement("DIV");t.classList.add("alerta",o),t.textContent=e,n.parentElement.insertBefore(t,n),setTimeout(()=>{t.remove()},5e3)}salones.forEach(e=>{e.addEventListener("click",(function(o){EnvioId(e.querySelector(".id").innerHTML.trim(),"http://localhost:3001/salon")}))});