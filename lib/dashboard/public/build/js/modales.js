const solicitudes=document.querySelectorAll(".solicitudes");solicitudes.forEach(e=>{e.addEventListener("click",(function(o){EnvioId(e.querySelector(".id").innerHTML.trim(),"http://localhost:3001/solicitudes")}))});const usuarios=document.querySelectorAll(".usuarios");usuarios.forEach(e=>{e.addEventListener("click",(function(o){EnvioId(e.querySelector(".id").innerHTML.trim(),"http://localhost:3001/usuario")}))});const salones=document.querySelectorAll(".salones");salones.forEach(e=>{e.addEventListener("click",(function(o){EnvioId(e.querySelector(".id").innerHTML.trim(),"http://localhost:3001/salon")}))});const bloques=document.querySelectorAll(".bloques");function envioUsuario(){mostrarModal(modalNuevoUsuario())}function envioSalon(){mostrarModal(modalNuevoSalon())}function envioBloque(){mostrarModal(modalNuevoBloque())}function EnvioId(e,o){if(null!==e){var t=new FormData;t.append("id",e)}try{consultaApi(o,t).then((function(e){if("soporte"==e.remitente)var o=modalServicios(e);else if("docente"==e.remitente)o=modalUsuarios(e);else if("salon"==e.remitente)o=modalSalon(e);else if("bloque"==e.remitente){console.log(e);o=modalBloque(e)}mostrarModal(o,e.id)}))}catch(e){console.log(e)}}function modalServicios(e){if("terminado"===e.estado)var o="completa";else if("en_camino"===e.estado)o="camino";else o="pendiente";const t=document.createElement("DIV");t.classList.add("modal");var a="en_camino"===e.estado?"En Camino":e.estado;return t.innerHTML='\n        <form class="formulario"> \n            <div class="contenedor-titulo">\n            <legend class="">Solicitud '+a+' </legend> \n            <div class="imagen-estado '+o+'"></div>\n            </div>          \n            <div class="campo">\n                <label class="subtitulo" >Tipo:</label>\n                <label>'+e.tipo+'</label>\n            </div>\n            <div class="campo">\n                <label class="subtitulo">Bloque:</label>\n                <label>'+e.bloque+'</label>\n            </div>\n            <div class="campo">\n                <label class="subtitulo">Aula:</label>\n                <label>'+e.aula+'</label>\n            </div>\n            <div class="campo">\n                <label class="subtitulo">Usuario:</label>\n                <label>'+e.usuario+'</label>\n            </div>\n            <div class="campo">\n                <label class="subtitulo">Detalle:</label>\n                <label>'+e.detalle+'</label>\n            </div>                \n            <div class="opciones-unica">\n                <button type="button" class="cerrar-modal">Volver</button>\n            </div>\n        </form>\n    ',t}function modalUsuarios(e){var o="",t="";"docente"==e.rol?o="selected":t="selected";const a=document.createElement("DIV");return a.classList.add("modal"),a.innerHTML='\n        <form class="formulario" >\n                <legend>Usuario: '+e.usuario+'</legend>\n                <div class="campo">\n                    <label class="subtitulo">Usuario</label>\n                    <input\n                        type= "text"\n                        name = "usuario"\n                        placeholder="Ingresa el nombre de usuario"\n                        value="'+e.usuario+'"\n                        id="usuario"\n                    />\n                </div>\n                <div class="campo">\n                    <label class="subtitulo">Usuario</label>\n                    <input\n                        type= "password"\n                        name = "psw"\n                        placeholder="Ingresa el nombre de usuario"\n                        value="'+e.psw+'"\n                        id="psw"\n                    />\n                </div>\n                <div class="campo">\n                    <label class="subtitulo">Rol</label>\n                    <select id="rol">\n                        <option '+o+' value="docente">Docente</option>\n                        <option '+t+' value="soporte">Soporte</option>\n                    </select>\n                </div>\n                <div class="opciones">\n                    <input type="submit" class="submit-actualizar-usuario" value="Actualizar"/>\n                    <button type="button" class="cerrar-modal">Cancelar</button>\n                </div>\n            </form>\n    ',a}function modalNuevoUsuario(){const e=document.createElement("DIV");return e.classList.add("modal"),e.innerHTML='\n        <form action="/usuarios" class="formulario">\n                <legend>Añadir nuevo Usuario</legend>\n                <div class="campo">\n                    <label class="subtitulo">Correo</label>\n                    <input\n                        type= "email"\n                        name = "correo"\n                        placeholder="Ingresa el correo del usuario"\n                        id="correo"\n                    />\n                </div>\n                <div class="campo">\n                    <label class="subtitulo">Usuario</label>\n                    <input\n                        type= "text"\n                        name = "usuario"\n                        placeholder="Ingresa el nombre de usuario"\n                        id="usuario"\n                    />\n                </div>\n                <div class="campo">\n                    <label class="subtitulo">Rol</label>\n                    <select id="rol">\n                        <option value="ninguno">--Selecciona un Rol--</option>\n                        <option value="docente">Docente</option>\n                        <option value="soporte">Soporte</option>\n                    </select>\n                </div>\n                <div class="campo">\n                    <label class="subtitulo">Password</label>\n                    <input\n                        type= "password"\n                        name = "psw"\n                        placeholder="Ingresa el password del usuario"\n                        id="psw"\n                    />\n                </div>\n                <div class="opciones">\n                    <input type="submit" class="submit-nuevo-usuario" value="Crear Usuario"/>\n                    <button type="button" class="cerrar-modal">Cancelar</button>\n                </div>\n            </form>\n    ',e}function modalSalon(e){const o=document.createElement("DIV");return o.classList.add("modal"),o.innerHTML='\n    <form class="formulario">\n            <legend>Actualizar Salon</legend>\n            <div class="campo">\n                <label class="subtitulo">Nombre del Salon</label>\n                <input\n                    type= "text"\n                    name = "salon"\n                    placeholder="Ingresa el nombre del salon"\n                    value="'+e.salon+'"\n                    id="salon"\n                />\n            </div>\n            <div class="opciones">\n                <input type="submit" class="submit-actualiza-salon" value="Actualizar Salon"/>\n                <button type="button" class="cerrar-modal">Cancelar</button>\n            </div>\n        </form>\n',o}function modalBloque(e){const o=document.createElement("DIV");return o.classList.add("modal"),o.innerHTML='\n    <form class="formulario">\n            <legend>Actualizar Bloque</legend>\n            <div class="campo">\n                <label class="subtitulo">Nombre del Bloque</label>\n                <input\n                    type= "text"\n                    name = "bloque"\n                    placeholder="Ingresa el nombre del bloque"\n                    value="'+e.bloque+'"\n                    id="bloque"\n                />\n            </div>\n            <div class="opciones">\n                <input type="submit" class="submit-actualiza-bloque" value="Actualizar Bloque"/>\n                <button type="button" class="cerrar-modal">Cancelar</button>\n            </div>\n        </form>\n',o}function modalNuevoBloque(){const e=document.createElement("DIV");return e.classList.add("modal"),e.innerHTML='\n    <form class="formulario">\n            <legend>Agrega un nuevo Bloque</legend>\n            <div class="campo">\n                <label class="subtitulo">Nombre del Bloque</label>\n                <input\n                    type= "text"\n                    name = "bloque"\n                    placeholder="Ingresa el nombre del bloque"\n                    id="bloque"\n                />\n            </div>\n            <div class="opciones">\n                <input type="submit" class="submit-nuevo-bloque" value="Crear Bloque"/>\n                <button type="button" class="cerrar-modal">Cancelar</button>\n            </div>\n        </form>\n',e}function modalNuevoSalon(){const e=document.createElement("DIV");return e.classList.add("modal"),e.innerHTML='\n    <form class="formulario">\n            <legend>Añadir nuevo Salon</legend>\n            <div class="campo">\n                <label class="subtitulo">Nombre del Salon</label>\n                <input\n                    type= "text"\n                    name = "salon"\n                    placeholder="Ingresa el nombre del salon"\n                    id="salon"\n                />\n            </div>\n            <div class="opciones">\n                <input type="submit" class="submit-nuevo-salon" value="Crear Salon"/>\n                <button type="button" class="cerrar-modal">Cancelar</button>\n            </div>\n        </form>\n',e}async function submitNuevoSalon(){var e=0;const o=document.querySelector("#salon").value.trim().toUpperCase();if(""!=o){const t=await fetch("http://localhost:3000/aulas_nombre/"+o),a=await t.json();e=Object.keys(a.aulas).length}if(e>0)mostrarAlertaAfter("El Salon ya existe","error",document.querySelector("legend"));else if(""!=o)if(/^(laboratorio|aula)\s[\w\s]*$/.test(o.toLowerCase())){var t={nombre_aulas:""+o};console.log(t),enviarDatosApi("http://localhost:3000/aulas",JSON.stringify(t))}else mostrarAlertaAfter("El texto debe iniciar con aula o laboratorio seguidos de un espacio","error",document.querySelector("legend"));else mostrarAlertaAfter("El nombre del salon no debe ir vacio","error",document.querySelector("legend"))}async function submitNuevoBloque(){var e=0;const o=document.querySelector("#bloque").value.trim().toUpperCase();if(""!=o){const t=await fetch("http://localhost:3000/bloque_nombre/"+o),a=await t.json();e=Object.keys(a.bloques).length,console.log(a),console.log("http://localhost:3000/bloque_nombre/"+o)}if(e>0)mostrarAlertaAfter("El Bloque ya existe","error",document.querySelector("legend"));else if(""!=o)if(/^[a-zA-Z]$/.test(o.toUpperCase())){var t={nombre_bloques:""+o};console.log(t),enviarDatosApi("http://localhost:3000/bloques",JSON.stringify(t))}else mostrarAlertaAfter("El nombre del bloque solo es una letra","error",document.querySelector("legend"));else mostrarAlertaAfter("El nombre del Bloque no debe ir vacio","error",document.querySelector("legend"))}async function submitActualizarSalon(e){var o=0;const t=document.querySelector("#salon").value.trim().toUpperCase();if(""!=t){const e=await fetch("http://localhost:3000/aulas_nombre/"+t),a=await e.json();o=Object.keys(a.aulas).length}if(o>0)mostrarAlertaAfter("El Salon ya existe","error",document.querySelector("legend"));else if(""!=t)if(/^(laboratorio|aula)\s[\w\s]*$/.test(t.toLowerCase())){var a={nombre_aulas:""+t};console.log(a);var n=JSON.stringify(a);console.log(n),enviarDatosApi("http://localhost:3000/aulas/"+e,n,"PUT")}else mostrarAlertaAfter("El texto debe iniciar con aula o laboratorio seguidos de un espacio","error",document.querySelector("legend"));else mostrarAlertaAfter("El nombre del salon no debe ir vacio","error",document.querySelector("legend"))}async function submitActualizarBloque(e){const o=document.querySelector("#bloque").value.trim().toUpperCase();if(""!=o){const e=await fetch("http://localhost:3000/bloque_nombre/"+o),t=await e.json();cantidad=Object.keys(t.bloques).length,console.log(t),console.log("http://localhost:3000/bloque_nombre/"+o)}if(cantidad>0)mostrarAlertaAfter("El Bloque ya existe","error",document.querySelector("legend"));else if(""!=o)if(/^[a-zA-Z]$/.test(o.toLowerCase())){var t={nombre_bloques:""+o},a=JSON.stringify(t);console.log(a),enviarDatosApi("http://localhost:3000/bloques/"+e,a,"PUT")}else mostrarAlertaAfter("El nombre del bloque solo es una letra","error",document.querySelector("legend"));else mostrarAlertaAfter("El nombre del bloque no debe ir vacio","error",document.querySelector("legend"))}function modalNuevoSalon(){const e=document.createElement("DIV");return e.classList.add("modal"),e.innerHTML='\n        <form class="formulario">\n                <legend>Añadir nuevo Salon</legend>\n                <div class="campo">\n                    <label class="subtitulo">Nombre del Salon</label>\n                    <input\n                        type= "text"\n                        name = "salon"\n                        placeholder="Ingresa el nombre del salon"\n                        id="salon"\n                    />\n                </div>\n                <div class="opciones">\n                    <input type="submit" class="submit-nuevo-salon" value="Crear Salon"/>\n                    <button type="button" class="cerrar-modal">Cancelar</button>\n                </div>\n            </form>\n    ',e}function animar(){setTimeout(()=>{document.querySelector(".formulario").classList.add("animar")},100)}function mostrarModal(e,o=""){animar(),e.addEventListener("click",(function(t){if(t.preventDefault(),t.target.classList.contains("cerrar-modal")){document.querySelector(".formulario").classList.add("cerrar"),setTimeout(()=>{e.remove()},500)}t.target.classList.contains("submit-actualizar-usuario")&&submitActualizarUsuario(o),t.target.classList.contains("submit-nuevo-usuario")&&submitNuevaUsuario(),t.target.classList.contains("submit-nuevo-salon")&&submitNuevoSalon(),t.target.classList.contains("submit-actualiza-bloque")&&submitActualizarBloque(o),t.target.classList.contains("submit-nuevo-bloque")&&submitNuevoBloque(o),t.target.classList.contains("submit-actualiza-salon")&&submitActualizarSalon(o)})),document.querySelector(".dashboard").appendChild(e)}async function submitActualizarUsuario(e){console.log("aqui");const o=document.querySelector("#rol").value.trim().toLowerCase(),t=document.querySelector("#usuario").value.trim(),a=document.querySelector("#psw").value.trim();if(""==t||""==a)return void mostrarAlertaAfter("El usuario y el password no puede ir vacio","error",document.querySelector("legend"));if(!/^[a-zA-Z\s]+$/.test(t))return void mostrarAlertaAfter("El usuario solo debe contener letras","error",document.querySelector("legend"));var n={rol:""+o,usuario:""+t,psw:""+a};enviarDatosApi("http://localhost:3000/usuarios/"+e,JSON.stringify(n),"PUT")}async function submitNuevaUsuario(){var e=0;const o=document.querySelector("#correo").value.trim().toLowerCase(),t=document.querySelector("#rol").value.trim().toLowerCase(),a=document.querySelector("#usuario").value.trim(),n=document.querySelector("#psw").value.trim();if(""!=o){const t=await fetch("http://localhost:3000/usuarios2/"+o),a=await t.json();e=Object.keys(a.usuario).length}if(e>0)mostrarAlertaAfter("El usuario ya existe","error",document.querySelector("legend"));else if(""!=a&&""!=n&&""!=o)if("ninguno"!=t)if(/^[a-zA-Z\s]+$/.test(a))if(/@ups\.edu\.ec$/.test(o)){console.log(!1);var l={correo:""+o,rol:""+t,usuario:""+a,psw:""+n};enviarDatosApi("http://localhost:3000/usuarios",JSON.stringify(l))}else mostrarAlertaAfter("El correo debe contener '@ups.edu.ec'","error",document.querySelector("legend"));else mostrarAlertaAfter("El usuario solo debe contener letras","error",document.querySelector("legend"));else mostrarAlertaAfter("Debe elegir un rol","error",document.querySelector("legend"));else mostrarAlertaAfter("El usuario, password y el correo no puede ir vacio","error",document.querySelector("legend"))}async function enviarDatosApi(e,o,t="POST"){try{const a=await fetch(e,{method:t,headers:{"Content-Type":"application/json"},body:o}),n=await a.json();return console.log(n),"Updated"==n.message?alert("Actualizado"):"Saved"==n.message&&alert("Creado"),void location.reload()}catch(e){console.log(e)}}async function consultaApi(e,o){const t=await fetch(e,{method:"POST",body:o});return await t.json()}async function LeerApi(e){const o=await fetch(e);return await o.json()}function mostrarAlertaAfter(e,o,t){const a=document.querySelector(".alerta");a&&a.remove();const n=document.createElement("DIV");n.classList.add("alerta",o),n.textContent=e,t.parentElement.insertBefore(n,t.nextElementSibling),setTimeout(()=>{n.remove()},5e3)}function mostrarAlertaBefore(e,o,t){const a=document.querySelector(".alerta");a&&a.remove();const n=document.createElement("DIV");n.classList.add("alerta",o),n.textContent=e,t.parentElement.insertBefore(n,t),setTimeout(()=>{n.remove()},5e3)}function mostrarGrafico(){google.charts.load("current",{packages:["corechart"]}),google.charts.setOnLoadCallback((function(){var e=google.visualization.arrayToDataTable([["Solicitudes","Abrir puertas"],["completas",11],["en camino",2],["pendiente",2],["terminadas",2]]);new google.visualization.PieChart(document.getElementById("chart_div")).draw(e,{title:"Solicitudes de 2023 a 2025",is3D:!0,fontSize:16})}))}bloques.forEach(e=>{e.addEventListener("click",(function(o){EnvioId(e.querySelector(".id").innerHTML.trim(),"http://localhost:3001/bloque")}))});